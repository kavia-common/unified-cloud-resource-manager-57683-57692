{"is_source_file": true, "format": "TypeScript", "description": "This file is an index.ts TypeScript source file defining a queue processor edge function for a serverless environment. It processes queued operations and recommendation actions from a database, updates their statuses, and logs activity, primarily designed for a Supabase + Deno environment.", "external_files": ["https://deno.land/std/http/server.ts"], "external_methods": ["serve", "fetch", "Response"], "published": ["simulateOperation", "json", "apiHeaders", "updateRow", "writeActivity", "getUserIdFromJwt", "padB64"], "classes": [], "methods": [{"name": "function simulateOperation(op: string, params: any) { simulateOperation", "description": "Simulates executing an operation based on its type and parameters, returning a mock result.", "scope": "", "scopeKind": ""}, {"name": "function json(body: unknown, status = 200) { json", "description": "Creates a JSON HTTP Response with the provided body and status code.", "scope": "", "scopeKind": ""}, {"name": "function apiHeaders(key: string) { apiHeaders", "description": "Constructs headers for API requests, including API key and authorization.", "scope": "", "scopeKind": ""}, {"name": "async function updateRow(url: string, key: string, patch: Record<string, unknown>) { updateRow", "description": "Updates a row in a database table via a PATCH request.", "scope": "", "scopeKind": ""}, {"name": "async function writeActivity(url: string, key: string, userId: string, row: Record<string, unkno/ writeActivity", "description": "Logs an activity entry into the activity_log table.", "scope": "", "scopeKind": ""}, {"name": "function getUserIdFromJwt(token: string): string | null { getUserIdFromJwt", "description": "Extracts and returns the user ID from a JWT token payload.", "scope": "", "scopeKind": ""}, {"name": "function padB64(b: string) { padB64", "description": "Pads Base64 string for decoding.", "scope": "", "scopeKind": ""}], "calls": ["serve", "fetch", "Response", "updateRow", "writeActivity", "getUserIdFromJwt"], "search-terms": ["queue-processor", "Supabase Cron", "activity_log", "recommendation_actions", "operations", "serverless function", "Deno", "Edge Function"], "state": 2, "file_id": 64, "knowledge_revision": 190, "git_revision": "", "ctags": [{"_type": "tag", "name": "SERVICE_KEY", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const SERVICE_KEY = Deno.env.get(\"SUPABASE_SERVICE_ROLE_KEY\") || Deno.env.get(\"SUPABASE_ANON/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "SUPABASE_URL", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const SUPABASE_URL = Deno.env.get(\"SUPABASE_URL\");$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "apiHeaders", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^function apiHeaders(key: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "authHeader", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const authHeader = req.headers.get(\"Authorization\") || \"\";$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "body", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const body = await req.json().catch(() => ({}));$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "getUserIdFromJwt", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^function getUserIdFromJwt(token: string): string | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "json", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^function json(body: unknown, status = 200) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "jwt", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const jwt = authHeader.startsWith(\"Bearer \") ? authHeader.slice(7) : null;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "max", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const max = Number(body?.max || 20);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const now = new Date().toISOString();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "op", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    for (const op of ops) {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ops", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const ops: any[] = opsResp.ok ? await opsResp.json() : [];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "opsResp", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const opsResp = await fetch($/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "padB64", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^function padB64(b: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "parts", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const parts = token.split(\".\");$/", "language": "TypeScript", "kind": "constant", "scope": "getUserIdFromJwt", "scopeKind": "function"}, {"_type": "tag", "name": "payload", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const payload = JSON.parse(atob(padB64(parts[1])));$/", "language": "TypeScript", "kind": "constant", "scope": "getUserIdFromJwt", "scopeKind": "function"}, {"_type": "tag", "name": "processedOps", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    let processedOps = 0;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "processedRecActs", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    let processedRecActs = 0;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "ra", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    for (const ra of racs) {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "racs", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const racs: any[] = recActResp.ok ? await recActResp.json() : [];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "recActResp", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const recActResp = await fetch($/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "result", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^      const result = simulateOperation(op.operation, op.params);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "result", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^      const result = { message: `Applied recommendation ${ra.recommendation_id}` };$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "simulateOperation", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^function simulateOperation(op: string, params: any) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "updateRow", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^async function updateRow(url: string, key: string, patch: Record<string, unknown>) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const url = new URL(req.url);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "userId", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^    const userId = getUserIdFromJwt(jwt || \"\");$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "writeActivity", "path": "/home/kavia/workspace/code-generation/unified-cloud-resource-manager-57683-57692/supabase/functions/queue-processor/index.ts", "pattern": "/^async function writeActivity(url: string, key: string, userId: string, row: Record<string, unkno/", "language": "TypeScript", "kind": "function"}], "hash": "61817b18750deb4923abfe7f7d7c887a", "format-version": 4, "code-base-name": "react_frontend_dashboard", "filename": "supabase/functions/queue-processor/index.ts", "fields": [{"name": "let processedOps = 0;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let processedRecActs = 0;", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"190": ""}]}